<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <h:form>
        <p:growl showDetail="true" showSummary="true" autoUpdate="true" />
        <div class="ui-g">
            <div class="ui-g-12">
                <div class="card">
                    <h1>Descarga de Scraps CTL</h1>
                    <p>Seleccione la fecha de proceso.</p>

                    <p:calendar id="inline" value="#{homeBean.date}" mode="inline">
                        <p:ajax event="dateSelect" listener="#{homeBean.selectDate}"/>
                    </p:calendar>

                    <br/>

                    <div class="ui-g">

                        <div class="ui-g-12 ui-md-12 ui-lg-12" style="padding: 0">

                            <p:commandButton action="#{homeBean.process}" onclick="PF('poll').start();start()" value="Descargar"
                                             style="float: right" widgetVar="startButton1"/>

                        </div>

                    </div>

                </div>

                <p:poll interval="1" update="logs" widgetVar="poll" listener="#{homeBean.scroll}" autoStart="false" async="true"  />

                <p:dataTable id="logs" var="log" value="#{homeBean.logHelper.logs}" styleClass="logs">
                    <p:column style="padding: 0px">
                        <div class="ui-g dashboard">
                        <div class="ui-g-12" style="padding: 0px">
                            <div class="card overview">
                                <div class="overview-content clearfix">

                                    <span class="overview-title" style="font-size: 11px; color:#545454; margin: 0">#{log.timestamp}</span>
                                    <span class="overview-badge">
                                        <p:outputPanel rendered="#{log.level == 'INFO'}">
                                            <i class="fa fa-info-circle" style="font-size:48px;color:#5180ce52;"/>
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{log.level == 'WARNING'}">
                                            <i class="fa fa-warning" style="font-size:48px;color:#ffc10759;"/>
                                        </p:outputPanel>
                                        <p:outputPanel rendered="#{log.level == 'ERROR'}">
                                            <i class="ui-icon ui-icon-cancel" style="font-size:48px;color:#ff572273;"/>
                                        </p:outputPanel>
                                    </span>
                                    <span class="overview-detail" style="font-size: 11px; color:#545454; margin: 0">#{log.classname}</span>
                                    <span class="overview-detail" style="font-size: 11px; color:#545454; margin: 0">#{log.method}</span>
                                    <p:separator style="border-top: 0px solid rgb(219, 219, 219); border-bottom: 1px solid lightgray;"/>
                                    <span class="overview-detail" style="font-size: small; padding-top: 8px; color:#545454;">#{log.message}</span>
                                </div>

                            </div>
                        </div>
                    </div>
                    </p:column>

                </p:dataTable>

                <br/>

                <p:progressBar id="progressBarClient" widgetVar="pbClient" style="width:100%;display:none" styleClass="progress" mode="indeterminate"/>

            </div>
        </div>
        </h:form>

        <script type="text/javascript">

            function scroll() {
                $("html, body").animate({ scrollTop: $(document).height() }, 1000);
            }

            function start() {
                PF('startButton1').disable();

                $('.progress').show();

                window['progress'] = setInterval(function () {
                    var pbClient = PF('pbClient'),
                            oldValue = pbClient.getValue(),
                            newValue = oldValue + 10;

                    pbClient.setValue(pbClient.getValue() + 10);

                    if (newValue === 100) {
                        clearInterval(window['progress']);
                    }


                }, 1000);
            }

            function cancel() {
                $('.progress').hide();
                clearInterval(window['progress']);
                PF('pbClient').setValue(0);
                PF('startButton1').enable();
            }

        </script>
        
    </ui:define>

</ui:composition>